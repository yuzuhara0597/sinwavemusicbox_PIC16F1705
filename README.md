# sinwavemusicbox_PIC16F1705
PIC16F1705を使用した減衰正弦波オルゴール(単音)
# 使い方
回路図は以下の通りです。 
  
![screenshot](https://github.com/yuzuhara0597/sinwavemusicbox_PIC16F1705/blob/master/sinwav.png?raw=true)  
  
PIC16F1705にはPICkit等を通してプログラムを書き込んでください。  
  
デフォルトのプログラムでは電源を入れるとメロディがループします。曲の切り替え等でスイッチを追加する場合は適宜空いてるピンを使用してください。RC2(8番ピン)以外のGPIOは使用していません。 

なお、マイコン単体でもRC2ピンより音はでますが、スピーカを駆動させる場合はアンプを入れてください。  
推奨はLM4880を用いたバッファアンプです。LM4880のデータシートの「代表的なアプリケーション」を参考にしてください。  
マイコンの出力の時点で振幅は十分ありますので増幅させる必要はないと思います。  
また、回路図中の1uFのパスコンは必ず挿入するようにしてください。このプログラムでは音がならない場合もDACの電圧が0になりません。なのでパスコン無しに繋ぐとスピーカに直流が流れ最悪壊れます。 

# テンポのフォーマット
曲のテンポを変更する場合はtempo関数を使います。  
```
void tempo(float tempo)
```
この関数の引数にテンポを入れれば以降の音符はこのテンポでメロディを奏でます。
テンポの範囲は0以外の正の数です。500bpmではそれっぽく聞こえました。    

なお、このプログラムの起動時はデフォルトで120bpmとなっています。
## 例
テンポを108bpmにする場合
```
tempo(108);
```
# 音符のフォーマット
マイコンに音符を打ち込む場合はnote関数を用います。  
```
void note(unsigned char scale,unsigned char length,unsigned char octave)
```
## scale
この関数の第1引数scaleは音程を決める引数です。  
以下に音程と引数の対応表を記載します。  
  
  
| ドレミ | CDE | 引数 |
|:---:|:---:|:---:|
|ド |C |0 |
|ド# |C# |10 |
|レ |D |1 |
|レ# |D# |11 |
|ミ |E |2 |  
|ファ |F |3 |  
|ファ# |F# |13 |  
|ソ |G |4 |  
|ソ# |G# |14 |  
|ラ |A |5 |  
|ラ# |A# |15 |  
|シ |B |6 |  

見て分かる通りシャープ付きの音階は先頭が1になります。

## length
関数の第2引数は音符の長さを決める引数です。  
以下に音符の長さと引数の対応表を記載します。  

| x分音符 | 引数 |
----|---- 
| 16分 | 16 |
| 付点16分 | 116 |  
| 3連16分 | 216 |  
| 8分 | 8 |
| 付点8分 | 18 |  
| 3連16分 | 28 |  
| 4分 | 4 |
| 付点4分 | 14 |  
| 3連4分 | 24 |  
| 2分 | 2 |
| 付点2分 | 12 |  
| 3連2分 | 22 |
| 16分 | 16 |
| 付点16分 | 116 |  
| 3連16分 | 216 |  
| 全音符 | 1 |   
  
  
見て分かる通り付点になると先頭が1に、3連符になると先頭が2になります。

## octave
関数の第3引数はオクターブを決める引数です。  
880Hzのラの音を5オクターブ目としています。  
この引数については入れた数値とそのままオクターブが対応しています。  
(5オクターブ目なら5,6オクターブ目なら6)  
  
範囲は3オクターブ～7オクターブです。  

## 例
5オクターブ目の「ド」の音の4分音符は
```
note(0,4,5);
```
となります。  
  
6オクターブ目の「シ♭」の音の3連8分音符の場合は、  
```
note(15,28,6);
```
となります。
# 休符のフォーマット
休符を入れる場合はrest関数を用います。
```
void rest(unsigned char length)
```
この関数の引数lengthは音符のフォーマットのlengthと共通の書き方です。詳しくはそちらを御覧ください。

# ライセンス
MITライセンスです。
